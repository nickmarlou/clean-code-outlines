# Отладка (debug)

> **Отладка (англ. debug)** – это процесс определения и устранения причин ошибок. Этим она отличается от тестирования, направленного на обнаружение ошибок (с. 524).

## Поиск ошибки

Отладка включает диагностику причины ошибки и её исправление. Поиск причины обычно занимает 90% времени.

Подход к отладке, основанный на научном методе:

1. Стабилизировать ошибку (разобраться, как и при каких условиях она воспроизводится)

> Если дефект проявляется не всегда, его причину почти невозможно диагностировать. Перевод несистематического дефекта в разряд предсказуемых – один из самых сложных аспектов отладки (с. 530)

2. Собрать данные о возможных причинах ошибки (данные о состоянии программы, похожие issues на GitHub и так далее)
3. Проанализировать собранные данные и сформулировать гипотезу, объясняющую возникновение ошибки
4. Придумать эксперимент, который поможет подтвердить или опровергнуть гипотезу, и провести его (в случае неудачи – вернуться на 2 или 3 шаг)
5. Исправить дефект
6. Протестировать исправление

### Советы по поиску причин ошибок

#### Сбор данных

- Если ваш проверка не помогает обнаружить причину проблемы (или хотя бы данные, достаточные для выдвижения гипотезы), детализируйте и уточняйте проверку.
- Если на основе доступных данных не удаётся сформулировать удачную гипотезу, проведите дополнительные проверки, чтобы собрать больше данных.
- Воспроизведите ошибку несколькими способами. То общее, что объединяет эти способы, скорее всего, станет хорошим материалом для гипотезы.

#### Подготовка гипотез

- Используйте все данные, когда будете формулировать гипотезу. Если гипотеза противоречит части данных, она, скорее всего, неверна.
- Формулируйте гипотезы методом [«мозгового штурма»](https://en.wikipedia.org/wiki/Brainstorming), не обдумывайте варианты на этом этапе.

#### Работа с кодом

- Проверьте корректность минимальных фрагментов кода: отдельных функций, классов и методов. Пользуйтесь методом [«разделяй и властвуй»](https://en.wikipedia.org/wiki/Divide-and-conquer_algorithm), чтобы локализовать причину ошибки: отключите (удалите, закомментируйте) половину кода, а затем половину этой половины и так далее.
- С подозрением относитесь к классам и методам, которые ранее содержали ошибки.
- Проверьте код, изменённый недавно. Изучите различия между старой и новой версиями.
- Если причину не удаётся найти в конкретной области кода, рассмотрите возможность того, что причина находится совсем в другом месте.

#### Дисциплина

- Вносите изменения в код по одному, иначе в какой-то момент вы не сможете понять, что именно исправило ошибку.
- Составьте список подходов, которые хотите попробовать, чтобы не ходить по кругу.

#### Обсуждение проблемы и отдых

- Обсудите проблему с кем-то другим. Иногда сформулировать описание проблемы уже достаточно, чтобы придумать новую идею.
- В конце концов, отдохните от проблемы. Иногда чрезмерная концентрация мешает думать.

#### Инструменты

- Используйте отладчики и другие доступные инструменты.

**Обсуждение проблемы и отдых**

- Обсудите проблему с кем-то другим. Иногда сформулировать описание проблемы уже достаточно, чтобы придумать новую идею.
- В конце концов, отдохните от проблемы. Иногда чрезмерная концентрация мешает думать.
